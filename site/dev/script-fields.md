# Using Scripts

## Script Fields

These strings are available in Shell Script and AppleScript extensions. Where no
value is available, the field will be set to an empty string.

| Field Name             | Shell Script Variable                | AppleScript Placeholder                | Description                                                                                                                                                                                                                   |
| ---------------------- | ------------------------------------ | -------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `extension identifier` | `POPCLIP_EXTENSION_IDENTIFIER`       | `{popclip extension identifier}`       | This extension's identifier.                                                                                                                                                                                                  |
| `action identifier`    | `POPCLIP_ACTION_IDENTIFIER`          | `{popclip action identifier}`          | The identifier specified in the action's configuration, if any.                                                                                                                                                               |
| `text`                 | `POPCLIP_TEXT`                       | `{popclip text}`                       | The part of the selected plain text matching the specified regex or requirement.                                                                                                                                              |
| `full text`            | `POPCLIP_FULL_TEXT`                  | `{popclip full text}`                  | The selected plain text in its entirety.                                                                                                                                                                                      |
| `urlencoded text`      | `POPCLIP_URLENCODED_TEXT`            | `{popclip urlencoded text}`            | URL-encoded form of the matched text.                                                                                                                                                                                         |
| `html`                 | `POPCLIP_HTML`                       | `{popclip html}`                       | Sanitized HTML for the selection. CSS is removed, potentially unsafe tags are removed and markup is corrected. (`Capture HTML` must be specified.)                                                                            |
| `raw html`             | `POPCLIP_RAW_HTML`                   | `{popclip raw html}`                   | The original unsanitized HTML, if available. (`Capture HTML` must be specified.)                                                                                                                                              |
| `markdown`             | `POPCLIP_MARKDOWN`                   | `{popclip markdown}`                   | A conversion of the HTML to Markdown. (`Capture HTML` must be specified.)                                                                                                                                                     |
| `urls`                 | `POPCLIP_URLS`                       | `{popclip urls}`                       | Newline-separated list of web URLs that PopClip detected in the selected text.                                                                                                                                                |
| `modifier flags`       | `POPCLIP_MODIFIER_FLAGS`             | `{popclip modifier flags}`             | Modifier flags for the keys held down when the extension's button was clicked in PopClip. Values are as defined in [Modifier values](#modifier-values). For example, `0` for no modifiers, or `131072` if shift is held down. |
| `bundle identifier`    | `POPCLIP_BUNDLE_IDENTIFIER`          | `{popclip bundle identifier}`          | Bundle identifier of the app the text was selected in. For example, `com.apple.Safari`.                                                                                                                                       |
| `app name`             | `POPCLIP_APP_NAME`                   | `{popclip app name}`                   | Name of the app the text was selected in. For example, `Safari`.                                                                                                                                                              |
| `browser title`        | `POPCLIP_BROWSER_TITLE`              | `{popclip browser title}`              | The title of the web page that the text was selected from. (Supported browsers only.)                                                                                                                                         |
| `browser url`          | `POPCLIP_BROWSER_URL`                | `{popclip browser url}`                | The URL of the web page that the text was selected from. (Supported browsers only.)                                                                                                                                           |
| `option *`             | `POPCLIP_OPTION_*` _(all UPPERCASE)_ | `{popclip option *}` _(all lowercase)_ | One such value is generated for each option specified in `Options`, where `*` represents the `Option Identifier`. For boolean options, the value with be a string, either `0` or `1`.                                         |

### Indicating Errors

Scripts may indicate success or failure as follows:

| Result                                                                                                          | JavaScript                                                                                        | Shell Script  | AppleScript                                                           |
| --------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------- | ------------- | --------------------------------------------------------------------- |
| Success                                                                                                         | Complete without throwing error.                                                                  | Exit code `0` | Complete without throwing error.                                      |
| General error. (PopClip will show an "X".)                                                                      | Throw any error. (Example: `throw new Error('message')`.)                                         | Exit code `1` | Throw error with any code. (Example: `error "message" number 501`.)   |
| Error with user's settings, or not signed in. (PopClip will show an "X" and pop up the extension's options UI.) | Throw error with specific message 'Not signed in'. (Example: `throw new Error('Not signed in')`.) | Exit code `2` | Throw error with code `502`. (Example: `error "message" number 502`.) |
